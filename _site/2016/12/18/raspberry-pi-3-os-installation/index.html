<!DOCTYPE html>
<html lang="en-us">

  <head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-90658879-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-90658879-1');
  </script>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <link rel="icon" sizes="16x16 32x32 64x64" href="/public/favicon.ico">
  <link rel="icon" sizes="16x16 32x32 64x64" href="/public/icons/favicon.ico">
  <link rel="icon" type="image/png" sizes="196x196" href="/public/icons/favicon-192.png">
  <link rel="icon" type="image/png" sizes="160x160" href="/public/icons/favicon-160.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/public/icons/favicon-96.png">
  <link rel="icon" type="image/png" sizes="64x64" href="/public/icons/favicon-64.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/public/icons/favicon-32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/public/icons/favicon-16.png">
  <link rel="apple-touch-icon" href="/public/icons/favicon-57.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/public/icons/favicon-114.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/public/icons/favicon-72.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/public/icons/favicon-144.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/public/icons/favicon-60.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/public/icons/favicon-120.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/public/icons/favicon-76.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/public/icons/favicon-152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/public/icons/favicon-180.png">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
  <link href="https://fonts.googleapis.com/css?family=PT%20Serif" rel="stylesheet">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Raspberry Pi 3 OS Installation &middot; Venelin Petkov
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">


  <div class="sidebar-item">
      <img src="https://s.gravatar.com/avatar/b2133fea3fa95e847523b6f9a6884142?s=200"/>
  </div>

  <div class="sidebar-item">
    <p>This is my personal blog, so you can expect random bits and pieces about various hobby projects if mine. Also visit Engineering Learning Machines or contact me via LinkedIn.</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/">Home</a>

    

    
    
      
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/about/">About Me</a>
        
      
    
      
        
          <a class="sidebar-nav-item" href="/archive/">Archive</a>
        
      
    
      
    
      
        
      
    

    <a class="sidebar-nav-item" href="https://engineering-learning-machines.com">
      Engineering Learning Machines
    </a>

    <a class="sidebar-nav-item" href="https://github.com/rseed42">
        <span class="fa-stack fa-lg">
          <i class="fa fa-square-o fa-stack-2x"></i>
          <i class="fa fa-github fa-stack-1x"></i>
        </span>

      GitHub
    </a>
    <a class="sidebar-nav-item" href="https://linkedin.com/in/venelin-petkov-13374372">
        <span class="fa-stack fa-lg">
          <i class="fa fa-square-o fa-stack-2x"></i>
          <i class="fa fa-linkedin fa-stack-1x"></i>
        </span>
        LinkedIn Profile
    </a>

    </a>


    <span class="sidebar-nav-item">Currently v1.0.0</span>
  </nav>

  <div class="sidebar-item">
    <p>
      &copy; 2019. All rights reserved.
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Venelin Petkov</a>
            <small>Making things work since 1982</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="post">
  <h1 class="post-title">Raspberry Pi 3 OS Installation</h1>
  <span class="post-date">18 Dec 2016</span>
  <h4 id="overview">Overview</h4>
<p>Raspberry Pi 3 doesn’t have a built-in hard disk drive, it uses a micro-SD card instead. This card is usually not sold together with the Raspberry, so it has to be bought and installed separately, unless you have a kit that provides that already.</p>

<p>I would recommend to buy an SD card with at least 8 GB of memory. Due to the low price point I am using a 32 GB card.</p>

<p>I decided to go with Raspbian Lite because I’d like to have a minimal system for my sensor network controller. Since it is not going to have a monitor attached to it, most of the software bloat in alternative distributions is useless here. However, this means that the only (comfortable) way to access the device is via SSH. SSH is disabled by default in the latest version (2016-11-25), which means that some configuration tweaks will be necessary before booting up with the SD card.</p>

<h4 id="installing-the-image-on-the-sd-card">Installing the image on the SD Card</h4>
<p>First, we need to find the device name of the SD Card. The fdisk command shows us detailed information about disk drives and partitions:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>venelin@clevo ~ $ sudo fdisk -l

Disk /dev/sda: 232.9 GiB, 250059350016 bytes, 488397168 sectors
...
Disk /dev/mmcblk0: 29.7 GiB, 31914983424 bytes, 62333952 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disklabel type: dos
Disk identifier: 0xe47ffcac

Device         Boot Start      End  Sectors  Size Id Type
/dev/mmcblk0p1       2048 62332927 62330880 29.7G  b W95 FAT32

</code></pre></div></div>
<p>You can see that the device name of the SD card is /dev/mmcblk0 and it has one partition /dev/mmcblk0p1. We will copy the disk image directly to the disk drive /dev/mmcblk0.</p>

<p>First we need to unmount the existing partition if it is mounted:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>venelin@clevo ~ $ sudo umount /dev/mmcblk0p1
</code></pre></div></div>
<p>Now we can byte-copy the image with the dd command:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>venelin@clevo ~/Downloads $ sudo dd bs=4M if=2016-11-25-raspbian-jessie-lite.img of=/dev/mmcblk0
331+1 records in
331+1 records out
1390411776 bytes (1.4 GB) copied, 57.5949 s, 24.1 MB/s
</code></pre></div></div>
<p>Let’s also flush any unwritten data to prepare the SD card for removal:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo sync
</code></pre></div></div>
<p>We can check what the disk image now contains:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>venelin@clevo ~/Downloads $ sudo fdisk -l

Disk /dev/sda: 232.9 GiB, 250059350016 bytes, 488397168 sectors
...

Disk /dev/mmcblk0: 29.7 GiB, 31914983424 bytes, 62333952 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disklabel type: dos
Disk identifier: 0x244b8248

Device         Boot  Start     End Sectors  Size Id Type
/dev/mmcblk0p1        8192  137215  129024   63M  c W95 FAT32 (LBA)
/dev/mmcblk0p2      137216 2715647 2578432  1.2G 83 Linux
</code></pre></div></div>
<p>The Raspbian image contains two partitions:</p>

<ol>
  <li>A FAT32 boot partition</li>
  <li>The ext4 root partition of the OS</li>
</ol>

<p>We need to modify some configuration files before we move the SD Card to the Raspberry device. For clarity I created manually the local directories where they could be mounted:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>venelin@clevo ~/Downloads $ sudo mkdir -p /media/venelin/raspi/boot
venelin@clevo ~/Downloads $ sudo mkdir -p /media/venelin/raspi/root
</code></pre></div></div>
<p>Then mounted them with:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>venelin@clevo ~/Downloads $ sudo mount /dev/mmcblk0p1 -t vfat -o uid=venelin /media/venelin/raspi/boot/
venelin@clevo /media/venelin/raspi $ sudo mount /dev/mmcblk0p2 /media/venelin/raspi/root/
</code></pre></div></div>

<h4 id="ssh-activation">SSH Activation</h4>
<p>According to the latest Raspbian Lite changelog</p>

<p>http://downloads.raspberrypi.org/raspbian/release_notes.txt</p>

<p>SSH is now disabled by default. I don’t plan on using a monitor to access the Raspberry, therefore SSH must be enabled. This is fairly easy, we need only to create an empty file in the boot partition:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>venelin@clevo ~ $ touch /media/venelin/raspi/boot/ssh
</code></pre></div></div>

<h4 id="assigning-a-static-ip-address-obsolete">Assigning a Static IP Address (Obsolete)</h4>

<p>Note: This has worked for Raspbian Jessie, but the latest Raspbian Stretch has changed some of the networking configuration, and the below 
guide hasn’t been tested with that yet!</p>

<p>In my home network I like to have a dedicated IP for any server machine. This is mostly caused by lack of flexibility of my router software in regard to DHCP. It is at least possible to configure the range for dynamic IPs, so I have restricted them to a certain range. Anything above that can be safely assigned a static IP address.</p>

<p>In the latest versions of Raspbian it is best to configure a static IP via the DHCP configuration file</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/etc/dhcpcd.conf
</code></pre></div></div>

<p>The static IP configuration is added to the end of the file:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>interface eth0

static ip_address=192.168.0.100/24
static routers=192.168.0.1
static domain_name_servers=192.168.0.1
</code></pre></div></div>

<p>In this case my router has an IP 192.168.0.1.</p>

<h4 id="dhcp-configuration-for-wifi-updated-for-raspbian-stretch">DHCP Configuration For Wifi (Updated for Raspbian Stretch)</h4>

<p>In addition to enabling ssh via creating an empty file in the boot partition (see above), we also need to put the wifi credentials in the boot partition as well. Allegedly, <em>wpa_supplicant.conf</em> has to be fully specified, so we first copy the existing <em>/etc/wpa_supplicant/wpa_supplicant.conf</em> to <em>/boot/wpa_supplicant.conf</em>. Then, we can encode the wifi password:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wpa_passphrase "wifi ssid" "wifi password"

network={
	ssid="wifi ssid"
	#psk="wifi password"
	psk=7e74dd066afb9ee688dbc30cd223e2299e3429c7bc8081ed717ae2ef370ce4e1
}
</code></pre></div></div>
<p>The full configuration file looks as follows:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>country=DE
ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev
update_config=1
network={
	ssid="wifi ssid"
	psk=7e74dd066afb9ee688dbc30cd223e2299e3429c7bc8081ed717ae2ef370ce4e1
}
</code></pre></div></div>
<p>After the system boots for the first time, it moves the configuration file to its standard location at</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/etc/wpa_supplicant/wpa_supplicant.conf
</code></pre></div></div>

<h4 id="prepare-the-sd-card-for-removal">Prepare the SD Card for Removal</h4>

<p>The mounted partitions should be unmounted before the SD card is removed:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>venelin@clevo ~ $ sudo umount /dev/mmcblk0p1 
venelin@clevo ~ $ sudo umount /dev/mmcblk0p2
</code></pre></div></div>

</div>

<div class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/2018/05/31/moved-blog-to-github/">
            Blog Migration
            <small>31 May 2018</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2017/11/19/how-to-install-a-raspberry-camera-node-on-ros-kinetic-raspbian-stretch/">
            How to install a Raspberry Camera Node on ROS Kinetic (Raspbian Stretch)
            <small>19 Nov 2017</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2017/11/19/how-to-install-ros-robot-operating-system-on-raspberry-pi-3-with-raspbian-stretch/">
            How to Install ROS (Robot Operating System) On Raspberry Pi 3 with Raspbian Stretch
            <small>19 Nov 2017</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>

        

      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script>
      (function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', function(e) {
          var target = e.target;

          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;

          checkbox.checked = false;
        }, false);
      })(document);
    </script>
  </body>
</html>
